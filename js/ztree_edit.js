layui.define(["jquery","ztree"],function(e){!function(e){var t={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},o={onHoverOverNode:function(e,t){var r=l.getSetting(e.data.treeId),d=l.getRoot(r);d.curHoverNode!=t&&o.onHoverOutNode(e),d.curHoverNode=t,i.addHoverDom(r,t)},onHoverOutNode:function(e,t){var o=l.getSetting(e.data.treeId),r=l.getRoot(o);r.curHoverNode&&!l.isSelectedNode(o,r.curHoverNode)&&(i.removeTreeDom(o,r.curHoverNode),r.curHoverNode=null)},onMousedownNode:function(o,r){function d(o){if(0==p.dragFlag&&Math.abs(A-o.clientX)<g.edit.drag.minMoveSize&&Math.abs(L-o.clientY)<g.edit.drag.minMoveSize)return!0;var r,d,u,N,v,T=g.data.key.children;if(M.css("cursor","pointer"),0==p.dragFlag){if(0==n.apply(g.callback.beforeDrag,[g.treeId,E],!0))return c(o),!0;for(r=0,d=E.length;r<d;r++)0==r&&(p.dragNodeShowBefore=[]),(u=E[r]).isParent&&u.open?(i.expandCollapseNode(g,u,!u.open),p.dragNodeShowBefore[u.tId]=!0):p.dragNodeShowBefore[u.tId]=!1;p.dragFlag=1,m.showHoverDom=!1,n.showIfameMask(g,!0);var f=!0,O=-1;if(E.length>1){var x=E[0].parentTId?E[0].getParentNode()[T]:l.getNodes(g);for(v=[],r=0,d=x.length;r<d;r++)if(void 0!==p.dragNodeShowBefore[x[r].tId]&&(f&&O>-1&&O+1!==r&&(f=!1),v.push(x[r]),O=r),E.length===v.length){E=v;break}}for(f&&(R=E[0].getPreNode(),P=E[E.length-1].getNextNode()),I=s("<ul class='zTreeDragUL'></ul>",g),r=0,d=E.length;r<d;r++)(u=E[r]).editNameFlag=!1,i.selectNode(g,u,r>0),i.removeTreeDom(g,u),r>g.edit.drag.maxShowNodeNum-1||((N=s("<li id='"+u.tId+"_tmp'></li>",g)).append(s(u,a.id.A,g).clone()),N.css("padding","0"),N.children("#"+u.tId+a.id.A).removeClass(a.node.CURSELECTED),I.append(N),r==g.edit.drag.maxShowNodeNum-1&&(N=s("<li id='"+u.tId+"_moretmp'><a>  ...  </a></li>",g),I.append(N)));I.attr("id",E[0].tId+a.id.UL+"_tmp"),I.addClass(g.treeObj.attr("class")),I.appendTo(M),(h=s("<span class='tmpzTreeMove_arrow'></span>",g)).attr("id","zTreeMove_arrow_tmp"),h.appendTo(M),g.treeObj.trigger(a.event.DRAG,[o,g.treeId,E])}if(1==p.dragFlag){if(b&&h.attr("id")==o.target.id&&k&&o.clientX+w.scrollLeft()+2>e("#"+k+a.id.A,b).offset().left){var j=e("#"+k+a.id.A,b);o.target=j.length>0?j.get(0):o.target}else b&&(b.removeClass(a.node.TMPTARGET_TREE),k&&e("#"+k+a.id.A,b).removeClass(a.node.TMPTARGET_NODE+"_"+a.move.TYPE_PREV).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));b=null,k=null,C=!1,_=g;var z=l.getSettings();for(var B in z)z[B].treeId&&z[B].edit.enable&&z[B].treeId!=g.treeId&&(o.target.id==z[B].treeId||e(o.target).parents("#"+z[B].treeId).length>0)&&(C=!0,_=z[B]);var H=w.scrollTop(),F=w.scrollLeft(),V=_.treeObj.offset(),U=_.treeObj.get(0).scrollHeight,G=_.treeObj.get(0).scrollWidth,X=o.clientY+H-V.top,q=_.treeObj.height()+V.top-o.clientY-H,W=o.clientX+F-V.left,K=_.treeObj.width()+V.left-o.clientX-F,$=X<g.edit.drag.borderMax&&X>g.edit.drag.borderMin,Z=q<g.edit.drag.borderMax&&q>g.edit.drag.borderMin,J=W<g.edit.drag.borderMax&&W>g.edit.drag.borderMin,Q=K<g.edit.drag.borderMax&&K>g.edit.drag.borderMin,ee=X>g.edit.drag.borderMin&&q>g.edit.drag.borderMin&&W>g.edit.drag.borderMin&&K>g.edit.drag.borderMin,te=$&&_.treeObj.scrollTop()<=0,oe=Z&&_.treeObj.scrollTop()+_.treeObj.height()+10>=U,re=J&&_.treeObj.scrollLeft()<=0,de=Q&&_.treeObj.scrollLeft()+_.treeObj.width()+10>=G;if(o.target&&n.isChildOrSelf(o.target,_.treeId)){for(var ne=o.target;ne&&ne.tagName&&!n.eqs(ne.tagName,"li")&&ne.id!=_.treeId;)ne=ne.parentNode;var ae=!0;for(r=0,d=E.length;r<d;r++){if(u=E[r],ne.id===u.tId){ae=!1;break}if(s(u,g).find("#"+ne.id).length>0){ae=!1;break}}ae&&o.target&&n.isChildOrSelf(o.target,ne.id+a.id.A)&&(b=e(ne),k=ne.id)}u=E[0],ee&&n.isChildOrSelf(o.target,_.treeId)&&(!b&&(o.target.id==_.treeId||te||oe||re||de)&&(C||!C&&u.parentTId)&&(b=_.treeObj),$?_.treeObj.scrollTop(_.treeObj.scrollTop()-10):Z&&_.treeObj.scrollTop(_.treeObj.scrollTop()+10),J?_.treeObj.scrollLeft(_.treeObj.scrollLeft()-10):Q&&_.treeObj.scrollLeft(_.treeObj.scrollLeft()+10),b&&b!=_.treeObj&&b.offset().left<_.treeObj.offset().left&&_.treeObj.scrollLeft(_.treeObj.scrollLeft()+b.offset().left-_.treeObj.offset().left)),I.css({top:o.clientY+H+3+"px",left:o.clientX+F+3+"px"});var ie=0,le=0;if(b&&b.attr("id")!=_.treeId){var se=function(){b=null,k="",S=a.move.TYPE_INNER,h.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)},ce=null==k?null:l.getNodeCache(_,k),ue=(o.ctrlKey||o.metaKey)&&g.edit.drag.isMove&&g.edit.drag.isCopy||!g.edit.drag.isMove&&g.edit.drag.isCopy,Ne=!(!R||k!==R.tId),ve=!(!P||k!==P.tId),ge=u.parentTId&&u.parentTId==k,pe=(ue||!ve)&&n.apply(_.edit.drag.prev,[_.treeId,E,ce],!!_.edit.drag.prev),me=(ue||!Ne)&&n.apply(_.edit.drag.next,[_.treeId,E,ce],!!_.edit.drag.next),Te=(ue||!ge)&&!(_.data.keep.leaf&&!ce.isParent)&&n.apply(_.edit.drag.inner,[_.treeId,E,ce],!!_.edit.drag.inner);if(pe||me||Te){var fe=e("#"+k+a.id.A,b),Ee=ce.isLastNode?null:e("#"+ce.getNextNode().tId+a.id.A,b.next()),Ie=fe.offset().top,he=fe.offset().left,be=pe?Te?.25:me?.5:1:-1,Re=me?Te?.75:pe?.5:0:-1,Pe=(o.clientY+H-Ie)/fe.height();if((1==be||Pe<=be&&Pe>=-.2)&&pe?(ie=1-h.width(),le=Ie-h.height()/2,S=a.move.TYPE_PREV):(0==Re||Pe>=Re&&Pe<=1.2)&&me?(ie=1-h.width(),le=null==Ee||ce.isParent&&ce.open?Ie+fe.height()-h.height()/2:Ee.offset().top-h.height()/2,S=a.move.TYPE_NEXT):Te?(ie=5-h.width(),le=Ie,S=a.move.TYPE_INNER):se(),b&&(h.css({display:"block",top:le+"px",left:he+ie+"px"}),fe.addClass(a.node.TMPTARGET_NODE+"_"+S),D==k&&y==S||(Y=(new Date).getTime()),ce&&ce.isParent&&S==a.move.TYPE_INNER)){var we=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==ce.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===ce.tId&&(we=!1),we&&(window.zTreeMoveTimer=setTimeout(function(){S==a.move.TYPE_INNER&&ce&&ce.isParent&&!ce.open&&(new Date).getTime()-Y>_.edit.drag.autoOpenTime&&n.apply(_.callback.beforeDragOpen,[_.treeId,ce],!0)&&(i.switchNode(_,ce),_.edit.drag.autoExpandTrigger&&_.treeObj.trigger(a.event.EXPAND,[_.treeId,ce]))},_.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=ce.tId)}}else se()}else S=a.move.TYPE_INNER,b&&n.apply(_.edit.drag.inner,[_.treeId,E,null],!!_.edit.drag.inner)?b.addClass(a.node.TMPTARGET_TREE):b=null,h.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);D=k,y=S,g.treeObj.trigger(a.event.DRAGMOVE,[o,g.treeId,E])}return!1}function c(o){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),D=null,y=null,w.unbind("mousemove",d),w.unbind("mouseup",c),w.unbind("selectstart",u),M.css("cursor",""),b&&(b.removeClass(a.node.TMPTARGET_TREE),k&&e("#"+k+a.id.A,b).removeClass(a.node.TMPTARGET_NODE+"_"+a.move.TYPE_PREV).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER)),n.showIfameMask(g,!1),m.showHoverDom=!0,0!=p.dragFlag){p.dragFlag=0;var r,N,v;for(r=0,N=E.length;r<N;r++)(v=E[r]).isParent&&p.dragNodeShowBefore[v.tId]&&!v.open&&(i.expandCollapseNode(g,v,!v.open),delete p.dragNodeShowBefore[v.tId]);I&&I.remove(),h&&h.remove();var T=(o.ctrlKey||o.metaKey)&&g.edit.drag.isMove&&g.edit.drag.isCopy||!g.edit.drag.isMove&&g.edit.drag.isCopy;if(!T&&b&&k&&E[0].parentTId&&k==E[0].parentTId&&S==a.move.TYPE_INNER&&(b=null),b){var f=function(){if(C){if(!T)for(var e=0,t=E.length;e<t;e++)i.removeNode(g,E[e]);S==a.move.TYPE_INNER?i.addNodes(_,R,-1,P):i.addNodes(_,R.getParentNode(),S==a.move.TYPE_PREV?R.getIndex():R.getIndex()+1,P)}else if(T&&S==a.move.TYPE_INNER)i.addNodes(_,R,-1,P);else if(T)i.addNodes(_,R.getParentNode(),S==a.move.TYPE_PREV?R.getIndex():R.getIndex()+1,P);else if(S!=a.move.TYPE_NEXT)for(e=0,t=P.length;e<t;e++)i.moveNode(_,R,P[e],S,!1);else for(e=-1,t=P.length-1;e<t;t--)i.moveNode(_,R,P[t],S,!1);i.selectNodes(_,P);var r=s(P[0],g).get(0);i.scrollIntoView(g,r),g.treeObj.trigger(a.event.DROP,[o,_.treeId,P,R,S,T])},R=null==k?null:l.getNodeCache(_,k);if(0==n.apply(g.callback.beforeDrop,[_.treeId,E,R,S,T],!0))return void i.selectNodes(O,E);var P=T?n.clone(E):E;S==a.move.TYPE_INNER&&n.canAsync(_,R)?i.asyncNode(_,R,!1,f):f()}else i.selectNodes(O,E),g.treeObj.trigger(a.event.DROP,[o,g.treeId,E,null,null,null])}}function u(){return!1}var N,v,g=l.getSetting(o.data.treeId),p=l.getRoot(g),m=l.getRoots();if(2==o.button||!g.edit.enable||!g.edit.drag.isCopy&&!g.edit.drag.isMove)return!0;var T=o.target,f=l.getRoot(g).curSelectedList,E=[];if(l.isSelectedNode(g,r))for(N=0,v=f.length;N<v;N++){if(f[N].editNameFlag&&n.eqs(T.tagName,"input")&&null!==T.getAttribute("treeNode"+a.id.INPUT))return!0;if(E.push(f[N]),E[0].parentTId!==f[N].parentTId){E=[r];break}}else E=[r];i.editNodeBlur=!0,i.cancelCurEditNode(g);var I,h,b,R,P,w=e(g.treeObj.get(0).ownerDocument),M=e(g.treeObj.get(0).ownerDocument.body),C=!1,_=g,O=g,D=null,y=null,k=null,S=a.move.TYPE_INNER,A=o.clientX,L=o.clientY,Y=(new Date).getTime();return n.uCanDo(g)&&w.bind("mousemove",d),w.bind("mouseup",c),w.bind("selectstart",u),o.preventDefault&&o.preventDefault(),!0}},r={tools:{getAbs:function(e){var t=e.getBoundingClientRect(),o=document.body.scrollTop+document.documentElement.scrollTop,r=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+r,t.top+o]},inputFocus:function(e){e.get(0)&&(e.focus(),n.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}},showIfameMask:function(e,t){for(var o=l.getRoot(e);o.dragMaskList.length>0;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(t)for(var r=s("iframe",e),d=0,a=r.length;d<a;d++){var i=r.get(d),c=n.getAbs(i),u=s("<div id='zTreeMask_"+d+"' class='zTreeMask' style='top:"+c[1]+"px; left:"+c[0]+"px; width:"+i.offsetWidth+"px; height:"+i.offsetHeight+"px;'></div>",e);u.appendTo(s("body",e)),o.dragMaskList.push(u)}}},view:{addEditBtn:function(e,t){if(!(t.editNameFlag||s(t,a.id.EDIT,e).length>0)&&n.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var o=s(t,a.id.A,e),r="<span class='"+a.className.BUTTON+" edit' id='"+t.tId+a.id.EDIT+"' title='"+n.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+a.id.EDIT+" style='display:none;'></span>";o.append(r),s(t,a.id.EDIT,e).bind("click",function(){return!(!n.uCanDo(e)||0==n.apply(e.callback.beforeEditName,[e.treeId,t],!0))&&(i.editNode(e,t),!1)}).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||s(t,a.id.REMOVE,e).length>0)&&n.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var o=s(t,a.id.A,e),r="<span class='"+a.className.BUTTON+" remove' id='"+t.tId+a.id.REMOVE+"' title='"+n.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+a.id.REMOVE+" style='display:none;'></span>";o.append(r),s(t,a.id.REMOVE,e).bind("click",function(){return!(!n.uCanDo(e)||0==n.apply(e.callback.beforeRemove,[e.treeId,t],!0))&&(i.removeNode(e,t),e.treeObj.trigger(a.event.REMOVE,[e.treeId,t]),!1)}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){l.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(i.addEditBtn(e,t),i.addRemoveBtn(e,t)),n.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,o){var r=l.getRoot(e),d=e.data.key.name,c=r.curEditNode;if(c){var u=r.curEditInput,N=t||(o?c[d]:u.val());if(!1===n.apply(e.callback.beforeRename,[e.treeId,c,N,o],!0))return!1;c[d]=N;s(c,a.id.A,e).removeClass(a.node.CURSELECTED_EDIT),u.unbind(),i.setNodeName(e,c),c.editNameFlag=!1,r.curEditNode=null,r.curEditInput=null,i.selectNode(e,c,!1),e.treeObj.trigger(a.event.RENAME,[e.treeId,c,o])}return r.noSelection=!0,!0},editNode:function(e,t){var o=l.getRoot(e);if(i.editNodeBlur=!1,l.isSelectedNode(e,t)&&o.curEditNode==t&&t.editNameFlag)setTimeout(function(){n.inputFocus(o.curEditInput)},0);else{var r=e.data.key.name;t.editNameFlag=!0,i.removeTreeDom(e,t),i.cancelCurEditNode(e),i.selectNode(e,t,!1),s(t,a.id.SPAN,e).html("<input type=text class='rename' id='"+t.tId+a.id.INPUT+"' treeNode"+a.id.INPUT+" >");var d=s(t,a.id.INPUT,e);d.attr("value",t[r]),e.edit.editNameSelectAll?n.inputSelect(d):n.inputFocus(d),d.bind("blur",function(t){i.editNodeBlur||i.cancelCurEditNode(e)}).bind("keydown",function(t){"13"==t.keyCode?(i.editNodeBlur=!0,i.cancelCurEditNode(e)):"27"==t.keyCode&&i.cancelCurEditNode(e,null,!0)}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),s(t,a.id.A,e).addClass(a.node.CURSELECTED_EDIT),o.curEditInput=d,o.noSelection=!1,o.curEditNode=t}},moveNode:function(e,t,o,r,d,n){var c=l.getRoot(e),u=e.data.key.children;if(t!=o&&(!e.data.keep.leaf||!t||t.isParent||r!=a.move.TYPE_INNER)){var N=o.parentTId?o.getParentNode():c,v=null===t||t==c;v&&null===t&&(t=c),v&&(r=a.move.TYPE_INNER);var g=t.parentTId?t.getParentNode():c;r!=a.move.TYPE_PREV&&r!=a.move.TYPE_NEXT&&(r=a.move.TYPE_INNER),r==a.move.TYPE_INNER&&(v?o.parentTId=null:(t.isParent||(t.isParent=!0,t.open=!!t.open,i.setNodeLineIcos(e,t)),o.parentTId=t.tId));var p,m;if(v)m=p=e.treeObj;else{if(n||r!=a.move.TYPE_INNER?n||i.expandCollapseNode(e,t.getParentNode(),!0,!1):i.expandCollapseNode(e,t,!0,!1),p=s(t,e),m=s(t,a.id.UL,e),p.get(0)&&!m.get(0)){var T=[];i.makeUlHtml(e,t,T,""),p.append(T.join(""))}m=s(t,a.id.UL,e)}var f=s(o,e);f.get(0)?p.get(0)||f.remove():f=i.appendNodes(e,o.level,[o],null,-1,!1,!0).join(""),m.get(0)&&r==a.move.TYPE_INNER?m.append(f):p.get(0)&&r==a.move.TYPE_PREV?p.before(f):p.get(0)&&r==a.move.TYPE_NEXT&&p.after(f);var E,I,h=-1,b=0,R=null,P=null,w=o.level;if(o.isFirstNode)h=0,N[u].length>1&&((R=N[u][1]).isFirstNode=!0);else if(o.isLastNode)h=N[u].length-1,(R=N[u][h-1]).isLastNode=!0;else for(E=0,I=N[u].length;E<I;E++)if(N[u][E].tId==o.tId){h=E;break}if(h>=0&&N[u].splice(h,1),r!=a.move.TYPE_INNER)for(E=0,I=g[u].length;E<I;E++)g[u][E].tId==t.tId&&(b=E);if(r==a.move.TYPE_INNER?(t[u]||(t[u]=new Array),t[u].length>0&&((P=t[u][t[u].length-1]).isLastNode=!1),t[u].splice(t[u].length,0,o),o.isLastNode=!0,o.isFirstNode=1==t[u].length):t.isFirstNode&&r==a.move.TYPE_PREV?(g[u].splice(b,0,o),(P=t).isFirstNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!0,o.isLastNode=!1):t.isLastNode&&r==a.move.TYPE_NEXT?(g[u].splice(b+1,0,o),(P=t).isLastNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!0):(r==a.move.TYPE_PREV?g[u].splice(b,0,o):g[u].splice(b+1,0,o),o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!1),l.fixPIdKeyValue(e,o),l.setSonNodeLevel(e,o.getParentNode(),o),i.setNodeLineIcos(e,o),i.repairNodeLevelClass(e,o,w),!e.data.keep.parent&&N[u].length<1){N.isParent=!1,N.open=!1;var M=s(N,a.id.UL,e),C=s(N,a.id.SWITCH,e),_=s(N,a.id.ICON,e);i.replaceSwitchClass(N,C,a.folder.DOCU),i.replaceIcoClass(N,_,a.folder.DOCU),M.css("display","none")}else R&&i.setNodeLineIcos(e,R);P&&i.setNodeLineIcos(e,P),e.check&&e.check.enable&&i.repairChkClass&&(i.repairChkClass(e,N),i.repairParentChkClassWithSelf(e,N),N!=o.parent&&i.repairParentChkClassWithSelf(e,o)),n||i.expandCollapseParentNode(e,o.getParentNode(),!0,d)}},removeEditBtn:function(e,t){s(t,a.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){s(t,a.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,i.removeEditBtn(e,t),i.removeRemoveBtn(e,t),n.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,o){if(o!==t.level){var r=s(t,e),d=s(t,a.id.A,e),n=s(t,a.id.UL,e),i=a.className.LEVEL+o,l=a.className.LEVEL+t.level;r.removeClass(i),r.addClass(l),d.removeClass(i),d.addClass(l),n.removeClass(i),n.addClass(l)}},selectNodes:function(e,t){for(var o=0,r=t.length;o<r;o++)i.selectNode(e,t[o],o>0)}},event:{},data:{setSonNodeLevel:function(e,t,o){if(o){var r=e.data.key.children;if(o.level=t?t.level+1:0,o[r])for(var d=0,n=o[r].length;d<n;d++)o[r][d]&&l.setSonNodeLevel(e,o,o[r][d])}}}};e.extend(!0,e.fn.zTree.consts,t),e.extend(!0,e.fn.zTree._z,r);var d=e.fn.zTree,n=d._z.tools,a=d.consts,i=d._z.view,l=d._z.data,s=(d._z.event,n.$);l.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}}),l.addInitBind(function(e){var t=e.treeObj,o=a.event;t.bind(o.RENAME,function(t,o,r,d){n.apply(e.callback.onRename,[t,o,r,d])}),t.bind(o.DRAG,function(t,o,r,d){n.apply(e.callback.onDrag,[o,r,d])}),t.bind(o.DRAGMOVE,function(t,o,r,d){n.apply(e.callback.onDragMove,[o,r,d])}),t.bind(o.DROP,function(t,o,r,d,a,i,l){n.apply(e.callback.onDrop,[o,r,d,a,i,l])})}),l.addInitUnBind(function(e){var t=e.treeObj,o=a.event;t.unbind(o.RENAME),t.unbind(o.DRAG),t.unbind(o.DRAGMOVE),t.unbind(o.DROP)}),l.addInitCache(function(e){}),l.addInitNode(function(e,t,o,r,d,n,a){o&&(o.isHover=!1,o.editNameFlag=!1)}),l.addInitProxy(function(e){var t=e.target,r=l.getSetting(e.data.treeId),d=e.relatedTarget,i="",s=null,c="",u=null,N=null;if(n.eqs(e.type,"mouseover")?(N=n.getMDom(r,t,[{tagName:"a",attrName:"treeNode"+a.id.A}]))&&(i=n.getNodeMainDom(N).id,c="hoverOverNode"):n.eqs(e.type,"mouseout")?(N=n.getMDom(r,d,[{tagName:"a",attrName:"treeNode"+a.id.A}]))||(i="remove",c="hoverOutNode"):n.eqs(e.type,"mousedown")&&(N=n.getMDom(r,t,[{tagName:"a",attrName:"treeNode"+a.id.A}]))&&(i=n.getNodeMainDom(N).id,c="mousedownNode"),i.length>0)switch(s=l.getNodeCache(r,i),c){case"mousedownNode":u=o.onMousedownNode;break;case"hoverOverNode":u=o.onHoverOverNode;break;case"hoverOutNode":u=o.onHoverOutNode}return{stop:!1,node:s,nodeEventType:c,nodeEventCallback:u,treeEventType:"",treeEventCallback:null}}),l.addInitRoot(function(e){var t=l.getRoot(e),o=l.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,o.showHoverDom=!0}),l.addZTreeTools(function(e,t){t.cancelEditName=function(e){l.getRoot(this.setting).curEditNode&&i.cancelCurEditNode(this.setting,e||null,!0)},t.copyNode=function(e,t,o,r){if(!t)return null;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===a.move.TYPE_INNER)return null;var d=this,l=n.clone(t);if(e||(e=null,o=a.move.TYPE_INNER),o==a.move.TYPE_INNER){var s=function(){i.addNodes(d.setting,e,-1,[l],r)};n.canAsync(this.setting,e)?i.asyncNode(this.setting,e,r,s):s()}else i.addNodes(this.setting,e.parentNode,-1,[l],r),i.moveNode(this.setting,e,l,o,!1,r);return l},t.editName=function(e){e&&e.tId&&e===l.getNodeCache(this.setting,e.tId)&&(e.parentTId&&i.expandCollapseParentNode(this.setting,e.getParentNode(),!0),i.editNode(this.setting,e))},t.moveNode=function(e,t,o,r){function d(){i.moveNode(l.setting,e,t,o,!1,r)}if(!t)return t;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===a.move.TYPE_INNER)return null;if(e&&(t.parentTId==e.tId&&o==a.move.TYPE_INNER||s(t,this.setting).find("#"+e.tId).length>0))return null;e||(e=null);var l=this;return n.canAsync(this.setting,e)&&o===a.move.TYPE_INNER?i.asyncNode(this.setting,e,r,d):d(),t},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}});var c=i.cancelPreSelectedNode;i.cancelPreSelectedNode=function(e,t){for(var o=l.getRoot(e).curSelectedList,r=0,d=o.length;r<d&&(t&&t!==o[r]||(i.removeTreeDom(e,o[r]),!t));r++);c&&c.apply(i,arguments)};var u=i.createNodes;i.createNodes=function(e,t,o,r,d){u&&u.apply(i,arguments),o&&i.repairParentChkClassWithSelf&&i.repairParentChkClassWithSelf(e,r)};var N=i.makeNodeUrl;i.makeNodeUrl=function(e,t){return e.edit.enable?null:N.apply(i,arguments)};var v=i.removeNode;i.removeNode=function(e,t){var o=l.getRoot(e);o.curEditNode===t&&(o.curEditNode=null),v&&v.apply(i,arguments)};var g=i.selectNode;i.selectNode=function(e,t,o){var r=l.getRoot(e);return(!l.isSelectedNode(e,t)||r.curEditNode!=t||!t.editNameFlag)&&(g&&g.apply(i,arguments),i.addHoverDom(e,t),!0)};var p=n.uCanDo;n.uCanDo=function(e,t){var o=l.getRoot(e);return!(!t||!(n.eqs(t.type,"mouseover")||n.eqs(t.type,"mouseout")||n.eqs(t.type,"mousedown")||n.eqs(t.type,"mouseup")))||(o.curEditNode&&(i.editNodeBlur=!1,o.curEditInput.focus()),!o.curEditNode&&(!p||p.apply(i,arguments)))}}(layui.$),e("ztree.edit",{})});