layui.define(["jquery","jqelem"],function(t){var e=layui.jquery,i=layui.jqelem,n=function(){this.config={item:".jqadmin-tab-box",closed:!0,showIcon:!0}},a={};n.prototype.set=function(t){return"string"==typeof t&&""!=t?this.config.item=t:"object"==typeof t&&e.extend(!0,this.config,t),this},n.prototype.init=function(t){var i=this,n=i.config,o=e(""+n.item),r=o.attr("lay-filter");return void 0!==r&&""!==r||console.log("错误:请设置Tab菜单选项卡属性lay-filter过滤器"),a.titleBox=o.children("ul.layui-tab-title"),a.contentBox=o.children("div.layui-tab-content"),a.tabFilter=r,i.hideRightMenu(),i.drag(),i},n.prototype.exited=function(t){var i=-1,n=t.href;return void 0===a.titleBox&&this.init(),a.titleBox.find("li").each(function(t,a){e(this).children("em").data("href")===n&&(i=e(this).attr("lay-id"))}),i},n.prototype.beforeTabAdd=function(t,e){},n.prototype.changeTab=function(t,e,i){},n.prototype.afterTabClose=function(t,e){},n.prototype.tabAdd=function(t,n){var o=this.exited(t),r=this,l=t.cls||"iconfont";if(-1===o){r.beforeTabAdd(t,r);var s=t.layId?t.layId:(new Date).getTime(),c='<iframe src="'+t.href+'" data-id="'+s+'" class="jqadmin-iframe"></iframe>',d="";r.config.showIcon?d+='<i class="'+l+'">'+t.icon+"</i>":d+='<i class="'+l+' hide-icon">'+t.icon+"</i>",d+='<em data-href="'+t.href+'">'+t.title+"</em>",this.config.closed&&(d+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+s+'">&#9747;</i>'),i.tabAdd(a.tabFilter,{title:d,content:c,id:s}),t.nodo||(t.layId=s,r.storage(t,"add")),r.effect(s),this.config.closed&&a.titleBox.find("li").children("i.layui-tab-close[data-id="+s+"]").on("click",function(){i.tabDelete(a.tabFilter,e(this).parent("li").attr("lay-id"),t.parent),r.tabMove(1,1),r.afterTabClose(t,r),i.init(),r.storage(t,"close")}),this.tabMove(o,0),i.tabChange(a.tabFilter,s),a.titleBox.find("li:not([bind])").on("contextmenu",function(t){e(this).attr("bind",1);var i=e(this).attr("lay-id"),n=t||window.event;return e(".right-click-menu").attr("lay-id",i).css({top:n.pageY,left:n.pageX}).slideDown(100),e(".right-click-menu").find("a:not([bind])").on("click",{_this:r},r.rightMenuEvent),!1})}else i.tabChange(a.tabFilter,o),r.changeTab(t,r,o),r.effect(o,!0),r.storage(t,"change"),this.tabMove(o,0),n&&r.fresh(o)},n.prototype.effect=function(t,i){var n=layer.load(2);i?(a.contentBox.find("iframe[data-id="+t+"]").css({opacity:"0","margin-top":"50px"}).delay(200).animate({opacity:"1",marginTop:"0"},200),layer.close(n)):a.contentBox.find("iframe[data-id="+t+"]").css({opacity:"0","margin-top":"50px"}).load(function(){e(this).delay(100).animate({opacity:"1",marginTop:"0"},200),layer.close(n)})},n.prototype.rightMenuEvent=function(t){var n=t.data._this;t=e(this).data("event");e(this).attr("bind",1);var o=e(this).parents(".right-click-menu").attr("lay-id");switch(e(this).parents(".right-click-menu").hide(),e(".menu-list").slideUp(),e(".tab-move-btn").removeClass("open").find("i").html("&#xe604;"),t){case"close":0!=o&&i.tabDelete(a.tabFilter,o);var r={layId:o};n.storage(r,"close");break;case"other":a.titleBox.find("li").each(function(t,n){var r=e(n).attr("lay-id");r!=o&&0!=r&&i.tabDelete(a.tabFilter,r)});r={layId:o};n.storage(r,"other");break;case"all":a.titleBox.find("li").each(function(t,o){var r=e(o).attr("lay-id");0!=r&&i.tabDelete(a.tabFilter,r);var l={layId:r};n.storage(l,"all")});break;default:n.fresh(o)}n.tabMove(1,1),e(this).parents(".right-click-menu").hide(),i.init()},n.prototype.storage=function(t,e){if(null==t.title&&"all"!=e)return!1;var i=window.sessionStorage,n=JSON.stringify(t);if("add"==e){if(i.menu){(o=(o=i.menu).split("|")).remove(n),o.push(n);var a=o.join("|");i.menu=a}else i.menu=n;i.curMenu=n}else if("all"==e)i.removeItem("curMenu"),i.removeItem("menu");else{var o;if(!(o=i.menu))return;if(o=o.split("|"),"close"==e){for(index in o)if("remove"!=index){if("string"==typeof o[index])a=JSON.parse(o[index]);a.layId==t.layId&&o.splice(index,1)}i.menu=o.join("|"),i.removeItem("curMenu")}else{for(index in o)if("remove"!=index){if("string"==typeof o[index])a=JSON.parse(o[index]);if(a.layId==t.layId)n=o[index]}"change"==e?i.curMenu=n:"other"==e&&(i.curMenu=n,i.menu=n)}}},n.prototype.fresh=function(t){i.tabChange(a.tabFilter,t);var e=a.titleBox.find('>li[lay-id="'+t+'"]'),n=(t=e.parent().children("li").index(e),e.parents(".layui-tab").eq(0).children(".layui-tab-content").children(".layui-tab-item")),o=n.eq(t).find("iframe").attr("src");n.eq(t).find("iframe").attr("src",o)},n.prototype.hideRightMenu=function(){e(document).on("contextmenu",function(t){e(this).find(".right-click-menu").hide()}),e(document).on("click",function(t){e(this).find(".right-click-menu").hide()})},n.prototype.tabMove=function(t,i){var n=parseInt(a.titleBox.parent("div").width()),o=a.titleBox.find("li"),r=0;if(o[0])if(o.each(function(t,i){r+=e(i).outerWidth(!0)}),r>n+1){e(".tab-move-btn").show();var l=n-r;if(l<45){if(t>=0){var s=0;try{s=parseInt(a.titleBox.find(".layui-this").position().left)}catch(t){}var c=parseInt(a.titleBox.css("marginLeft"));if(s+parseInt(c)<=45)l=45-s;else if(-(c-n+parseInt(a.titleBox.find(".layui-this").outerWidth(!0))+s)<=0)l=n-s-parseInt(a.titleBox.find(".layui-this").outerWidth(!0));else{if(!(1==i&&parseInt(c)<0))return;(l=n-s-parseInt(a.titleBox.find(".layui-this").outerWidth(!0)))>45&&(l=45)}}a.titleBox.css({marginLeft:l})}}else e(".tab-move-btn").hide(),a.titleBox.css({marginLeft:45})},n.prototype.drag=function(){a.titleBox.on("mousedown",function(t){var i=parseInt(a.titleBox.parent("div").width()),n=a.titleBox.find("li"),o=0;if(n.each(function(t,i){o+=e(i).outerWidth(!0)}),n[0]&&o>i+1){var r=o-i+54,l=t.pageX-parseInt(a.titleBox.css("marginLeft"));return a.titleBox.on("mousemove",function(t){x=t.pageX-l,x>45?x=45:x<-r&&(x=-r),a.titleBox.css({marginLeft:x})}),a.titleBox.parents("body").on("mouseup",function(t){a.titleBox.off("mousemove")}),!1}})},Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)},t("tabmenu",function(t){return(new n).set(t)})});